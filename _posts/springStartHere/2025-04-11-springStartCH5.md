---
title: "Spring Start Here Chapter5 스프링 컨텍스트: 빈의 스코프 및 수명 주기"
date: 2025-04-11 09:00:00 +0900
categories: [Spring]
tags: [java, spring, backend]
---
# CHAPTER5: (스프링 컨텍스트: 빈의 스코프 및 수명 주기)

- 스프링에서 빈의 스코프는 프레임워크가 객체 인스턴스를 관리하는 방법을 정의한다.

- 스프링은 싱글톤과 프로토타입이라는 두 가지 빈 스코프를 제공한다.

## 싱글톤

- 싱글톤을 사용하면 스프링은 해당 컨텍스트에서 직접 객체 인스턴스를 관리한다. 각 인스턴스에는 고유한 이름이 있으며, 이 이름을 사용하여 항상 특정 인스턴스를 참조한다. 싱글톤은 스프링의 기본 스코프다.

- 싱글톤 빈의 스코프는 앱의 여러 컴포넌트가 하나의 객체 인스턴스를 공유할 수 있다고 가정하기 때문에 가장 중요하게 고려해야 할 점은 이런 빈이 불변(immutable)이어야 한다는 것이다. 대부분 실제 앱은 여러 스레드로 작업들을 실행하기 때문에 여러 스레드가 동일한 인스턴스를 변경하면 경쟁상태(race condition)시나리오가 발생한다.

> 빈의 사용 방법은 다음 세 가지로 귀결된다. <br>
>
> 1. 프레임워크가 특정 기능으로 해당 빈을 보강할 수 있도록 스프링에서 관리해야 할 때만 스프링 컨텍스트에 객체 빈을 생성한다. 프레임워크에서 제공되는 기능이 객체에 필요하지 않다면 객체를 빈으로 만들 필요 없다.
> 2. 스프링 컨텍스트에서 객체 빈을 만들어야 한다면 불변인 경우에만 싱글톤으로 만들어야 한다. 변경 가능한 싱글톤은 설계❌
> 3. 빈을 변경 가능해야 한다면 프로토타입 스코프를 사용하는 것이 방법이 될 수 있다.

- 생성자DI의 장점 중 하나는 인스턴스를 불변으로 만들 수 있다는 것 -> 생성자 DI가 필드 주입보다 선호되는 방법인 이유

### 즉시 및 지연 인스턴스 생성 방식

- 스프링이 싱글톤 빈을 생성하는 두 시점(스프링 컨텍스트가 초기화될 때(eager) 또는 빈이 첫 번째 참조될 때(lazy))을 설정할 수 있다. 기본적으로 빈은 즉시 인스턴스 생성 방식으로 생성된다.

- @Bean 메서드에 @Lazy 애너테이션을 추가해서 지연 인스턴스 생성 방식 사용 가능함.

## 프로토타입

- 프로토타입을 사용하면 스프링은 객체 타입만 고려한다. 각 타입에는 고유한 이름이 있다. 스프링은 빈 이름을 참조할 때마다 해당 타입의 새로운 인스턴스를 생성한다.

### @Bean으로 프로토타입 스코프의 빈 선언

```java
@Configuration
public class ProjectConfig{

  @Bean
  @Scope(BeanDefinition.SCOPE_PROTOTYPE)  // 빈을 프로토타입 스코프로 만든다.
  public CommentService commentService(){
    return new CommentService();
  }
}
```

### 스테레오타입 애너테이션으로 프로토타입 스코프 빈 선언

```java
@Repository
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
public class CommentRepository{
}
```

```java
@Service
public class CommentService{

  @Autowired
  private CommentRepository commentRepository;

  public CommentRepository getCommentRepository(){
    return commentRepository;
  }
}
```

- 앱에서는 싱글톤 빈을 주로 사용한다. 동일한 이름으로 참조하는 모든 곳에서 동일한 객체 인스턴스를 얻기 때문에 여러 스레드가 이 인스턴스를 액세스하여 사용할 수 있다. 따라서 인스턴스는 불변으로 만들면 좋다. 하지만 빈 속성에 대해 변경 작업을 수행하고 싶다면 스레드 동기화를 처리하는 것은 사용자 책임이다.

- 프로토타입 스코프의 빈을 싱글톤 스코프의 빈에 주입할 때는 주의해야 한다. 이렇게 하면 싱글톤 인스턴스는 항상 동일한 프로토타입 인스턴스를 사용하게 된다. 스프링이 싱글톤 인스턴스를 생성할 시점에 동일한 프로토타입 인스턴스를 주입하기 때문이다. 이는 일반적으로 악성 설계다. 빈을 프로토타입 스코프로 만드는 이유는 사용할 때 항상 독립된 인스턴스를 얻어야 하기 때문이다.

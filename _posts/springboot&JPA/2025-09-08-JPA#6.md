---
title: "[JPA]@Transaction"
date: 2025-09-08 09:00:00 +0900
categories: [Spring]
tags: [jpa, transaction, java, spring, backend]
---
# @Transactional

> @Transactionalì€ í•˜ë‚˜ì˜ ë©”ì„œë“œ ë˜ëŠ” í´ë˜ìŠ¤ ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì‘ì—…ì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ ë‹¨ìœ„ë¡œ ë¬¶ì–´ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜<br>
> ì¦‰, ë©”ì„œë“œ ì•ˆì˜ ëª¨ë“  ì‘ì—…ì´ ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜, í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì „ë¶€ ë¡¤ë°±ë˜ë„ë¡ ë³´ì¥í•¨

## ì£¼ìš” ê°œë…

- íŠ¸ëœì­ì…˜(Transaction): ë°ì´í„°ë² ì´ìŠ¤ì˜ í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„, ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼í•¨
- ì»¤ë°‹(Commit): íŠ¸ëœì­ì…˜ì˜ ì‘ì—…ì„ í™•ì •/ì €ì¥
- ë¡¤ë°±(Rollback): íŠ¸ëœì­ì…˜ì˜ ì‘ì—…ì„ ë˜ëŒë¦¼, ì—ëŸ¬ ë°œìƒ ì‹œ ì£¼ë¡œ ì‹¤í–‰

## ë™ì‘ ë°©ì‹

```java
@Transactional
public void doSomething() {
    repository.save(entity1);  // INSERT
    repository.save(entity2);  // INSERT
    throw new RuntimeException(); // ì˜ˆì™¸ ë°œìƒ
}
```

- repositoryê°€ jparepositoryêµ¬í˜„ì²´ê¸° ë•Œë¬¸ì— save()í•˜ë‚˜ë„ ê¸°ë³¸ì ìœ¼ë¡œ transactionë‹¨ìœ„ë¡œ ì‹¤í–‰ë¨
- ë°‘ì— ì˜ˆì™¸ê°€ ì—†ë”ë¼ë„ entity1, entity2ê°€ dbì— ì €ì¥ë˜ê¸° ì „ê¹Œì§€ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ì§€ ì•ŠìŒ.
- ë©”ì†Œë“œ ì „ì²´ê°€ íŠ¸ëœì­ì…˜ ë‹¨ìœ„ì¸ë° RuntimeExceptionì´ ë°œìƒí•˜ë¯€ë¡œ, ì „ì²´ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ê³  DBì—ëŠ” ì•„ë¬´ê²ƒë„ ì €ì¥ë˜ì§€ ì•Šì•„.

### ì„ ì–¸ ìœ„ì¹˜ì— ë”°ë¼

- í´ë˜ìŠ¤ì— ì„ ì–¸í•˜ë©´ â¡ï¸ í´ë˜ìŠ¤ì˜ ëª¨ë“  public ë©”ì„œë“œì— íŠ¸ëœì­ì…˜ ì ìš©
- ë©”ì„œë“œì— ì„ ì–¸í•˜ë©´ â¡ï¸ í•´ë‹¹ ë©”ì„œë“œì— íŠ¸ëœì­ì…˜ ì ìš©

### ì£¼ìš” ì˜µì…˜

| ì†ì„±                       | ì„¤ëª…                                   | ì˜ˆì‹œ                                                  |
| :------------------------- | :------------------------------------- | :---------------------------------------------------- |
| readOnly = true            | ì½ê¸° ì „ìš© ì¿¼ë¦¬ (ì“°ê¸° ë°©ì§€ & ì„±ëŠ¥ í–¥ìƒ) | @Transactional(readOnly = true)                       |
| rollbackFor = ì˜ˆì™¸.class   | íŠ¹ì • ì˜ˆì™¸ ë°œìƒ ì‹œ ë¡¤ë°±                 | @Transactional(rollbackFor = IOException.class)       |
| noRollbackFor = ì˜ˆì™¸.class | íŠ¹ì • ì˜ˆì™¸ëŠ” ë¡¤ë°± ì•ˆ í•¨                 | @Transactional(noRollbackFor = CustomException.class) |
| propagation                | íŠ¸ëœì­ì…˜ ì „íŒŒ ë°©ì‹ ì„¤ì •                | ê¸°ë³¸: REQUIRED                                        |

#### íŠ¸ëœì­ì…˜ ì „íŒŒ(propagation)

íŠ¸ëœ ì­ì…˜ì´ ì¤‘ì²©ë  ë–„ì˜ ë™ì‘ì„ ì œì–´í•¨

- REQUIRED: ê¸°ì¡´ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ìˆìœ¼ë©´ ì°¸ì—¬, ì—†ìœ¼ë©´ ìƒˆë¡œ ì‹œì‘(ê¸°ë³¸ê°’)
- REQUIRES_NEW: ë¬´ì¡°ê±´ ìƒˆ íŠ¸ëœì­ì…˜ ì‹œì‘
- NESTED: ê¸°ì¡´ íŠ¸ëœì­ì…˜ ì•ˆì— ì¤‘ì²© íŠ¸ëœì­ì…˜ ì‹œì‘(savepointìƒì„±)

## âš ï¸âš ï¸ @Transactional ì£¼ì˜ ì‚¬í•­ âš ï¸âš ï¸

1. ëŸ°íƒ€ì„ ì˜ˆì™¸ë§Œ ë¡¤ë°±ë¨<br>
   â†’ checked ì˜ˆì™¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¡¤ë°± ì•ˆ ë¨ (rollbackFor ëª…ì‹œ í•„ìš”)
2. âœ¨âœ¨í”„ë¡ì‹œ ê¸°ë°˜ ë™ì‘âœ¨âœ¨<br>
   â†’ ê°™ì€ í´ë˜ìŠ¤ ë‚´ì—ì„œ this.ë©”ì„œë“œ()ì²˜ëŸ¼ í˜¸ì¶œí•˜ë©´ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠìŒ
3. íŠ¸ëœì­ì…˜ ì•ˆì—ì„œëŠ” ì§€ì—° ë¡œë”© ì£¼ì˜<br>
   â†’ Lazy ë¡œë”©ì€ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ë©´ ë™ì‘ ì•ˆ í•  ìˆ˜ ìˆìŒ

## AOP

[ì˜›ë‚  í¬ìŠ¤íŠ¸](/posts/springStartCH6/)

> AOP(ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°): í•µì‹¬ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì— ê³µí†µê¸°ëŠ¥ì„ ë”°ë¡œ ë¶„ë¦¬í•´ì„œ, í•„ìš”í•œ ê³³ì— ìë™ìœ¼ë¡œ ë¼ì›Œë„£ëŠ” ê¸°ë²•

- íŠ¸ëœì­ì…˜ ì²˜ë¦¬
- ë¡œê¹…
- ë³´ì•ˆ ê²€ì‚¬
- ì„±ëŠ¥ ì¸¡ì • ë“±

ë§ì€ ë©”ì„œë“œì—ì„œ ë°˜ë³µë˜ì§€ë§Œ ë¡œì§ë§ˆë‹¤ ì§ì ‘ ë„£ê¸°ì—” ë¹„íš¨ìœ¨ì ì´ë¼ AOPë¡œ ë¶„ë¦¬í•¨

### AOP ë™ì‘ ë°©ì‹

#### 1. Aspect

- ê³µí†µì ì¸ ê¸°ëŠ¥(ì˜ˆ: ë¡œê¹…, íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ë“±)ì„ ë¶„ë¦¬í•´ì„œ ê´€ë¦¬í•˜ëŠ” ëª¨ë“ˆ.
- @Aspectë¡œ ì •ì˜ë¨.

#### 2. Join Point

- ì‹¤í–‰ ì‹œì (execution point), ì˜ˆ: ë©”ì„œë“œ í˜¸ì¶œ, ìƒì„±ì í˜¸ì¶œ ë“±.

#### 3. Pointcut

- ì–´ë–¤ Join Pointì— Adviceë¥¼ ì ìš©í• ì§€ ê²°ì •í•˜ëŠ” ì¡°ê±´.
- ì˜ˆ: execution(_ com.example.service.._(..)) â†’ íŠ¹ì • íŒ¨í‚¤ì§€ì˜ ëª¨ë“  ë©”ì„œë“œ

#### 4. Advice

- ì‹¤ì œë¡œ ì‹¤í–‰ë˜ëŠ” ë¶€ê°€ ê¸°ëŠ¥ ë¡œì§.
- ì¢…ë¥˜:
- @Before: ë©”ì„œë“œ ì‹¤í–‰ ì „
- @After: ë©”ì„œë“œ ì‹¤í–‰ í›„
- @AfterReturning: ì •ìƒ ì¢…ë£Œ í›„
- @AfterThrowing: ì˜ˆì™¸ ë°œìƒ ì‹œ
- @Around: ë©”ì„œë“œ ì‹¤í–‰ ì „í›„ ì „ì²´ ì œì–´

### ê·¸ë˜ì„œ

```
[ë‚´ê°€ í˜¸ì¶œí•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ê°€ì§„ ë¹ˆì˜ ë©”ì„œë“œ]
â†’ [ì• í”„í™íŠ¸ í´ë˜ìŠ¤ê°€ ì‹¤í–‰ íë¦„ì„ ê°€ë¡œì±”]
â†’ [ì›í•˜ëŠ” ê¸°ëŠ¥ ìˆ˜í–‰]
```

AOP ëŒ€ìƒì´ ëœ ìŠ¤í”„ë§ ë¹ˆì€ ì‹¤ì œ êµ¬í˜„ì²´ê°€ ì•„ë‹Œ í”„ë¡ì‹œ ê°ì²´ë¡œ ê°ì‹¸ì§„ë‹¤.

ì•„ë˜ëŠ” ëŒ€í‘œì ì¸ ë¡œê¹…ì• í”„íŒ©íŠ¸ ì˜ˆì œì´ë‹¤

```java
@Aspect
@Component
public class LoggingAspect {

    @Around("execution(* com.example.service..*(..))")
    public Object logExecution(ProceedingJoinPoint joinPoint) throws Throwable {
        String methodName = joinPoint.getSignature().toShortString();
        System.out.println("ğŸ”µ [ì‹œì‘] " + methodName);

        Object result = joinPoint.proceed(); // ì‹¤ì œ ë©”ì„œë“œ ì‹¤í–‰

        System.out.println("âœ… [ì¢…ë£Œ] " + methodName);
        return result;
    }
}
```

## JPAì˜ AOPë°©ì‹ íŠ¸ëœì­ì…˜ ì²˜ë¦¬

```
@PostService.doSomething()
 â†“
[í”„ë¡ì‹œê°€ ê°€ë¡œì±”] â†’ @Transactional í™•ì¸
 â†“
íŠ¸ëœì­ì…˜ ì‹œì‘
 â†“
ì‹¤ì œ doSomething ì‹¤í–‰
 â†“
ì„±ê³µ â†’ ì»¤ë°‹ / ì‹¤íŒ¨ â†’ ë¡¤ë°±
```

### ì–´ë–¤ ê²½ìš°ì— í”„ë¡ì‹œ ê°ì²´ê°€ ìƒì„±ë˜ëŠ”ê°€?

> ìŠ¤í”„ë§ì—ì„œ í”„ë¡ì‹œ ê°ì²´ë¡œ wrappingë˜ëŠ” ê²½ìš°ëŠ” ë”± ë‘ê°€ì§€ì„

- @Transactional, @Async, @Cacheable ë“± AOP ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš© ì‹œ <br>
  -> ê³µí†µ ê´€ì‹¬ì‚¬(cross-cutting concern)ê°€ ì ìš©ë˜ëŠ” ê²½ìš°

- ì»¤ìŠ¤í…€ Aspect í´ë˜ìŠ¤(@Aspect)ë¥¼ ë§Œë“¤ì–´ íŠ¹ì • í¬ì¸íŠ¸ì»·/ì–´ë“œë°”ì´ìŠ¤ë¥¼ ì§€ì •í•œ ê²½ìš°<br>
  -> ì˜ˆ: íŠ¹ì • íŒ¨í‚¤ì§€ì˜ ëª¨ë“  ë©”ì„œë“œ ì‹¤í–‰ ì „ì— ë¡œê·¸ ì°ê¸° ë“±

ì´ì™¸ì˜ ê°ì²´ë“¤ì€ AOP ëŒ€ìƒì´ ì•„ë‹ˆë©´ í”„ë¡ì‹œ ì—†ì´ ì›ë³¸ ê°ì²´ ìì²´ê°€ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœë‹¤

#### í”„ë¡ì‹œ ê°ì²´ëŠ” ì–´ë–»ê²Œ ìƒì„±ë˜ëŠ”ê°€?

í”„ë¡ì‹œ ê°ì²´ëŠ” 'ì§„ì§œ ê°ì²´'ë¥¼ ê°ì‹¸ê³  ëŒ€ì‹  í–‰ë™í•˜ëŠ” ëŒ€ë¦¬ì¸ ê°ì²´

```java
MemberService service = new MemberService();
```

ìœ„ì˜ serviceê°ì²´ì— AOPê°€ ì ìš©ë˜ë©´ ì•„ë˜ì™€ ê°™ì´

```java
MemberService service = new Proxy(new MemberService());
```

í”„ë¡ì‹œ ê°ì²´ê°€ ì§„ì§œ ê°ì²´ë¥¼ ê°ì‹¸ê³ , ë©”ì„œë“œë¥¼ ëŒ€ì‹  ë°›ì•„ì„œ ë‚´ë¶€ì ìœ¼ë¡œ ì§„ì§œ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ëŠ” êµ¬ì¡°ì„!!

### âš ï¸âš ï¸ @Transactional ì£¼ì˜ ì‚¬í•­ âš ï¸âš ï¸ ì´ê±° ë–„ë¬¸ì— AOPë‚´ìš© ê¹”ìŒ

```
[ë‹¤ë¥¸ í´ë˜ìŠ¤] ---> [í”„ë¡ì‹œ ê°ì²´] ---> [ì§„ì§œ ê°ì²´]
                     â†‘
                   (ì—¬ê¸°ì„œ AOP Advice ì‹¤í–‰)
```

- AOPë¡œ ì• ìŠ¤íŒ©íŠ¸ë¥¼ ì ìš©í•˜ë©´ í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ì„œ ë™ì‘í•¨

- í”„ë¡ì‹œ ê°ì²´ëŠ” ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ê¸° ì „ì— í•„ìš”í•œ ì–´ë“œë°”ì´ìŠ¤(@Before, @Around ë“±)ë¥¼ ì‹¤í–‰í•˜ê³ 

- ê·¸ í›„ì— ì§„ì§œ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜, ì¡°ê±´ì— ë”°ë¼ ì•„ì˜ˆ í˜¸ì¶œí•˜ì§€ ì•Šê¸°ë„ í•¨

- í”„ë¡ì‹œëŠ” ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œ í˜¸ì¶œí•  ë•Œë§Œ ê°œì…í•  ìˆ˜ ìˆìŒ

```java
@Service
public class MyService {

    @Transactional
    public void methodA() {
        methodB(); // âŒ íŠ¸ëœì­ì…˜ ì ìš© ì•ˆë¨ (í”„ë¡ì‹œ ì•ˆ ê±°ì¹¨)
    }

    @Transactional
    public void methodB() {
        // ...
    }
}
```

```java
@Service
public class MemberService {

    @Transactional
    public void join() {
        ...
    }

    public void validate() {
        ...
    }
}
```

- ìœ„ì™€ ê°™ì´ ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ ë©”ì„œë“œ í˜¸ì¶œí•˜ë©´ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê¸° ë•Œë¬¸ì— AOPê°€ ì‘ë™í•˜ì§€ ì•ŠìŒ

- í”„ë¡ì‹œëŠ” ì™¸ë¶€ í˜¸ì¶œë§Œ ê°ì§€í•  ìˆ˜ ìˆë‹¤.

#### ë‚´ë¶€ì—ì„œ í˜¸ì¶œí•˜ë©´ ì™œ í”„ë¡ì‹œë¥¼ ìš°íšŒí•˜ê²Œ ë˜ëƒë©´

```java
@Service
public class MyService {
    @Transactional
    public void methodA() {
        methodB(); // ë‚´ë¶€ í˜¸ì¶œ
    }

    @Transactional
    public void methodB() {
        // DB ì‘ì—…
    }
}
```

ìŠ¤í”„ë§ì´ ì‹¤í–‰ ì‹œì ì— í•˜ëŠ” ì¼:

- MyService í´ë˜ìŠ¤ê°€ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ë©´
- ìŠ¤í”„ë§ì€ ì´ í´ë˜ìŠ¤ì˜ í”„ë¡ì‹œ ê°ì²´(MyServiceProxy) ë¥¼ ë§Œë“¤ì–´ì„œ ë“±ë¡í•¨
- ì´ í”„ë¡ì‹œ ê°ì²´ëŠ” íŠ¸ëœì­ì…˜ ì‹œì‘/ì»¤ë°‹/ë¡¤ë°± ë“±ì˜ ë…¼ë¦¬ë¥¼ ê°ì‹¸ê³  ìˆìŒ
- ë‹¤ë¥¸ ê³³ì—ì„œ MyServiceë¥¼ ì˜ì¡´ì„± ì£¼ì…ë°›ìœ¼ë©´ ì‹¤ì œ ê°ì²´ê°€ ì•„ë‹ˆë¼ í”„ë¡ì‹œ ê°ì²´ê°€ ì£¼ì…ë¨

```
SomeController -> [MyService Proxy] -> methodB()
                       â†‘ íŠ¸ëœì­ì…˜ ê°ì§€í•¨!
```

ê·¸ëŸ°ë° ë‚´ë¶€ì—ì„œ í˜¸ì¶œí•˜ê²Œ ë˜ë©´

```
[MyService Proxy] -> methodA() â†’ this.methodB()
                                 â†‘ ê·¸ëƒ¥ ì‹¤ì œ ê°ì²´ ë‚´ í˜¸ì¶œ
```

### ê·¸ëŸ¼ ë‚´ë¶€ í˜¸ì¶œì—ì„œë„ aopê°€ ë™ì‘í•˜ë ¤ë©´

ë°©ë²• 1: ìš°ì„  ë‹¤ë¥¸ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•˜ëŠ” ì§ê´€ì ì¸ ë°©ë²•ì´ ìˆìŒ

ë°©ë²• 2: í˜„ì¬ í´ë˜ìŠ¤ì˜ í”„ë¡ì‹œë¥¼ ì£¼ì…í•´ì„œ ìš°íšŒ í˜¸ì¶œ

```java
@RequiredArgsConstructor
@Service
public class MemberService {

    private final MemberService self; // í”„ë¡ì‹œ ìê¸° ìì‹ ì„ ì£¼ì… (ì£¼ì˜ í•„ìš”)

    @Transactional
    public void join() {
        self.validate(); // í”„ë¡ì‹œë¥¼ ê±°ì¹˜ê¸° ë•Œë¬¸ì— AOP ì‘ë™ O
    }

    @Transactional
    public void validate() {
        ...
    }
}
```

ì´ ë°©ë²•ì€ CGLIBí”„ë¡ì‹œ ë°©ì‹ì´ê³  ìˆœí™˜ ì°¸ì¡°ë¥¼ ì£¼ì˜í•´ì•¼ í•œë‹¤..
ì¶”ì²œë˜ëŠ” ë°©ë²•ì€ ì•„ë‹ˆê³ , ê·¸ëƒ¥ ì´í•´ë¥¼ ë•ê¸°ìœ„í•œ ì„¤ëª…ë°©ì‹ì´ë¼ê³  í•œë‹¤.

## @Transactional êµ¬í˜„ì²´ë¥¼ ê¹Œë³´ì•˜ì–´

```java
@Target({ElementType.TYPE, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Inherited
@Documented
@Reflective
public @interface Transactional {

	/**
	 * Alias for {@link #transactionManager}.
	 * @see #transactionManager
	 */
	@AliasFor("transactionManager")
	String value() default "";

  // ...ì—¬ëŸ¬ ë©”ì†Œë“œë“¤ì´ ë”ìˆìŒ...
}
```

### ì¸í„°í˜ì´ìŠ¤ì²˜ëŸ¼ ë³´ì´ëŠ”ë° ì–´ë–»ê²Œ ì‘ë™í•˜ì§€

ìë°”ì˜ ì–´ë…¸í…Œì´ì…˜ ë¬¸ë²•ì„ ë”°ë¥¸ ì¸í„°í˜ì´ìŠ¤ì²˜ëŸ¼ ìƒê¸´ ì–´ë…¸í…Œì´ì…˜ ì •ì˜ì´ë‹¤. ê·¼ë° ì´ê²Œ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ” ê±¸ê¹Œ...

### Runtime Retention

```java
@Retention(RetentionPolicy.RUNTIME)
```

- ì´ ëœ»ì€ JVMì´ ëŸ°íƒ€ì„ì—ë„ ì´ ì–´ë…¸í…Œì´ì…˜ ì •ë³´ë¥¼ ìœ ì§€í•œë‹¤ëŠ” ëœ»ì´ë¼ê³  í•œë‹¤.
- ì¦‰, ìŠ¤í”„ë§ì´ ë¦¬í”Œë ‰ì…˜(Reflection)ìœ¼ë¡œ í´ë˜ìŠ¤, ë©”ì„œë“œì— ë¶™ì€ ì–´ë…¸í…Œì´ì…˜ì„ ì½ì„ ìˆ˜ ìˆìŒ

### ìŠ¤í”„ë§ì´ ì´ê±¸ ì½ìœ¼ë©´

1. ìŠ¤í”„ë§ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ, @Transactionalì´ ë¶™ì€ í´ë˜ìŠ¤/ë©”ì„œë“œë¥¼ ìŠ¤ìº”í•¨
2. í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ í”„ë¡ì‹œ ê°ì²´ë¡œ ê°ìŒˆ

- AOP í”„ë¡ì‹œ (JDK ë™ì  í”„ë¡ì‹œ or CGLIB) ìƒì„±

3. ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´, í”„ë¡ì‹œê°€ ë¨¼ì € ê°œì…í•´ì„œ ë‹¤ìŒì„ ìˆ˜í–‰:

- íŠ¸ëœì­ì…˜ ì‹œì‘ (PlatformTransactionManager ì‚¬ìš©)
- ì‹¤ì œ ë©”ì„œë“œ ì‹¤í–‰ (super.method())
- ì˜ˆì™¸ ì—¬ë¶€ì— ë”°ë¼ ì»¤ë°‹/ë¡¤ë°±

### ì‹¤ì œ ë™ì‘

> @EnableTransactionManagement ì´ ì¹œêµ¬ê°€ ì‹¤í–‰í•¨<br>
> ê·¸ë¦¬ê³  ì•„ë˜ì™€ ê°™ì€ íë¦„ìœ¼ë¡œ ì‹¤í–‰ ëœë‹¤ê³  í•œë‹¤

```
@EnableTransactionManagement
        â†“
TransactionManagementConfigurationSelector
        â†“
1. AutoProxyRegistrar â†’ AOP í”„ë¡ì‹œ ìƒì„±
2. ProxyTransactionManagementConfiguration
        â†³ @Transactional ë§¤ì¹­ Pointcut ìƒì„±
        â†³ TransactionInterceptor ë“±ë¡
        â†“
â†’ í”„ë¡ì‹œ ê°ì²´ê°€ TransactionInterceptorë¥¼ Adviceë¡œ ê°€ì§
â†’ ë©”ì„œë“œ ì‹¤í–‰ ì‹œ, ë¨¼ì € TransactionInterceptor.invoke() ì‹¤í–‰ë¨!
```

```java
public class TransactionInterceptor implements MethodInterceptor {
    @Override
    public Object invoke(MethodInvocation invocation) throws Throwable {
        // 1. íŠ¸ëœì­ì…˜ ì‹œì‘
        // 2. ëŒ€ìƒ ë©”ì„œë“œ ì‹¤í–‰
        // 3. ì»¤ë°‹ or ë¡¤ë°±
    }
}
```

ìœ„ì™€ ê°™ì€ TransactionIntercepterë¼ëŠ” í´ë˜ìŠ¤ê°€ í”„ë¡ì‹œì— ì£¼ì…ë˜ì–´ ì–˜ë¥¼ ë³´ê³  ë©”ì„œë“œë¥¼ ê°€ë¡œì±„ê²Œ ëœë‹¤.

### @EnableTransactionManagement ì´ëŸ°ê±´ ë“±ë¡í•œì ì´ ì—†ëŠ”ë°?

Spring BootëŠ” ë‚´ë¶€ì ìœ¼ë¡œ @EnableTransactionManagementë¥¼ ìë™ìœ¼ë¡œ ë“±ë¡í•´ì¤Œ<br>
â†’ ê·¸ë˜ì„œ ëª…ì‹œì ìœ¼ë¡œ ì“´ ì  ì—†ì–´ë„ íŠ¸ëœì­ì…˜ì´ ë™ì‘í–ˆë˜ ê±°ì„

> ì™œ ìë™ìœ¼ë¡œ ë“±ë¡ë˜ëŠ”ë°?<br>
> ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ìë™ ì„¤ì •(Auto Configuration) ê¸°ëŠ¥ ë•ë¶„ì—
> ê°œë°œìê°€ ìì£¼ ì‚¬ìš©í•˜ëŠ” ì„¤ì •ì„ ë¯¸ë¦¬ ë“±ë¡í•´ì¤Œ

### ì‹¤ì œë¡œ gradleì— JPA ì˜ì¡´ì„±ì„ ì¶”ê°€í•˜ë©´

```java
@Configuration
@ConditionalOnClass({ DataSource.class, PlatformTransactionManager.class })
@AutoConfigureAfter({ DataSourceAutoConfiguration.class })
@EnableTransactionManagement // âœ… ì—¬ê¸° ë¶™ì–´ ìˆìŒ
public class DataSourceTransactionManagerAutoConfiguration {
    ...
}
```

Spring Bootì˜ í•µì‹¬ ìë™ ì„¤ì • í´ë˜ìŠ¤ ì¤‘ í•˜ë‚˜ì¸ DataSourceTransactionManagerAutoConfiguration ë‚´ë¶€ì—ì„œ ë“±ë¡

<br>

ì´ í´ë˜ìŠ¤ê°€ ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•  ë•Œ ìë™ìœ¼ë¡œ íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € + AOP ì„¤ì •ì„ í•´ì¤Œ:

- spring-boot-starter-data-jpa ë˜ëŠ” spring-boot-starter-jdbc ì˜ì¡´ì„±ì´ í¬í•¨ë˜ì–´ ìˆê³ 

- DataSource ë¹ˆì´ ë“±ë¡ë˜ì–´ ìˆìœ¼ë©´

ì¦‰, DataSourceì™€ ê´€ë ¨ ì˜ì¡´ì„±(JPA, JDBC ë“±)ì´ ìˆì„ ë•Œ ìë™ìœ¼ë¡œ @EnableTransactionManagementê°€ ìŠ¤í”„ë§ ìë™ì„¤ì • í´ë˜ìŠ¤ì— ì„¤ì •ë˜ê³ , @Transactionalì´ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ í•œë‹¤

## ì¶”ê°€ë¡œ ê³µë¶€í•´ë³¼ë§Œí•œ ì£¼ì œ

- JDK / CGLIB í”„ë¡ì‹œ ì°¨ì´

- [transactionality](https://docs.spring.io/spring-data/jpa/reference/jpa/transactions.html)

- [transaction management](https://docs.spring.io/spring-framework/reference/testing/testcontext-framework/tx.html)

- [transactionIntercepter](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/interceptor/TransactionInterceptor.html)
